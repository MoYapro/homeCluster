apiVersion: v1
kind: ConfigMap
metadata:
  name: home-assistant-config
  namespace: home-assistant
data:
  known_devices.yaml: |

  automations.yaml: |

  configuration.yaml: |
    homeassistant:
      # Name of the location where Home Assistant is running
      name: Home
      # Location required to calculate the time the sun rises and sets
      latitude: 51.483
      longitude: 11.972
      # Impacts weather/sunrise data (altitude above sea level in meters)
      elevation: 1
      # metric for Metric, imperial for Imperial
      unit_system: metric
      time_zone: Europe/Berlin

    # Show links to resources in log and frontend
    introduction:

    # Enables the frontend
    frontend:

    # Enables configuration UI
    config:

    #Enable support for mobile client
    mobile_app:

    # Uncomment this if you are using SSL/TLS, running in Docker container, etc.
    http:
      server_port: 8123
      base_url: home-assistant.cluster
      use_x_forwarded_for: true
      trusted_proxies: 127.0.0.1

    # Checks for available updates
    # Note: This component will send some information about your system to
    # the developers to assist with development of Home Assistant.
    # For more information, please see:
    # https://home-assistant.io/blog/2016/10/25/explaining-the-updater/
    updater:
      # Optional, allows Home Assistant developers to focus on popular components.
      # include_used_components: true

    # Discover some devices automatically
    discovery:

    # Allows you to issue voice commands from the frontend in enabled browsers
    conversation:

    # Enables support for tracking state changes over time
    history:

    # View all events in a logbook
    logbook:

    # Enables a map showing the location of tracked devices
    map:

    # Track the sun
    sun:

    # Allow diagnosing system problems
    system_health:

    # Sensors
    sensor:
      # Weather prediction
      - platform: yr

    # Text to speech
    tts:
      - platform: google_translate
        service_name: google_say

    #mqtt
    mqtt:
      broker: mosquitto-service
      port: 1883
      username: homeassistant
      password: password
      discovery: true

    # Cloud
    cloud:

    light:
      - platform: mqtt
        name: "Kleine Schlafzimmerlampe"
        state_topic: "stat/sonoff/RESULT"
        value_template: "{{ value_json.POWER }}"
        command_topic: "cmnd/sonoff/POWER"
        availability_topic: "tele/sonoff/LWT"
        qos: 1
        payload_on: "ON"
        payload_off: "OFF"
        payload_available: "Online"
        payload_not_available: "Offline"
        retain: false
      - platform: mqtt
        name: "GroÃŸe Schlafzimmerlampe"
        state_topic: "stat/sonoff-schlafzimmer-wand/RESULT"
        value_template: "{{ value_json.POWER1 }}"
        command_topic: "cmnd/sonoff-schlafzimmer-wand/POWER1"
        availability_topic: "tele/sonoff-schlafzimmer-wand/LWT"
        qos: 1
        payload_on: "ON"
        payload_off: "OFF"
        payload_available: "Online"
        payload_not_available: "Offline"
        retain: false
      - platform: mqtt
        name: "Wohnzimmerlampe"
        state_topic: "shellies/shelly1-68C700/relay/0"
        command_topic: "shellies/shelly1-68C700/relay/0/command"
        payload_on: "on"
        payload_off: "off"
        retain: false
      - platform: mqtt
        schema: template
        name: "LED"
        command_topic: "shellies/shellyrgbw2-6CA20C/color/0/set"
        state_topic: "shellies/shellyrgbw2-6CA20C/color/0/status"
        effect_list:
          - 0
          - 1
          - 2
          - 3
          - 4
          - 5
          - 6
        command_on_template: >
          {"turn": "on"
          {%- if brightness is defined -%}
          , "gain": {{brightness | float | multiply(0.3922) | round(0)}}
          {%- endif -%}
          {%- if red is defined and green is defined and blue is defined -%}
          , "red": {{ red }}, "green": {{ green }}, "blue": {{ blue }}
          {%- endif -%}
          {%- if white_value is defined -%}
          , "white": {{ white_value }}
          {%- endif -%}
          {%- if effect is defined -%}
          , "effect": {{ effect }}
          {%- endif -%}
          }
        command_off_template: '{"turn":"off"}'
        state_template: "{% if value_json.ison %}on{% else %}off{% endif %}"
        brightness_template: "{{ value_json.gain | float | multiply(2.55) | round(0) }}"
        red_template: '{{ value_json.red }}'
        green_template: '{{ value_json.green }}'
        blue_template: '{{ value_json.blue }}'
        white_value_template: '{{ value_json.white }}'
        effect_template: '{{ value_json.effect }}'
        qos: 2
    switch:
      - platform: mqtt
        name: "Grosses Aquarium"
        state_topic: "shellies/shellyplug-s-79D80C/relay/0"
        command_topic: "shellies/shellyplug-s-79D80C/relay/0/command"
        payload_on: "on"
        payload_off: "off"
        retain: false
      - platform: mqtt
        name: "Kleines Aquarium"
        state_topic: "shellies/shellyplug-s-7A3532/relay/0"
        command_topic: "shellies/shellyplug-s-7A3532/relay/0/command"
        payload_on: "on"
        payload_off: "off"
        retain: false
      - platform: mqtt
        name: "Computer"
        state_topic: "wohnzimmer/pc/status"
        command_topic: "wohnzimmer/pc/command"
        payload_on: "on"
        payload_off: "off"
        retain: false

    google_assistant:
      project_id: hassio-integration-1e887
      api_key: AIzaSyA-6kOMTvYajbaBSQZo1_INVALIDHTwnlU
      expose_by_default: true
      exposed_domains:
        - light
        - switch
        - script
        - fan

    automation: !include automations.yaml

